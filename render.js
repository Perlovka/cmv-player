"use strict";

let tileset = {
    tiles: [],
    colors: []
};

let frame = {
    width: 80,
    height: 25
};

let cmv;
let canvas;
let ctx;
let cur_frame = {"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":176,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":176,"59":0,"60":0,"61":0,"62":219,"63":176,"64":176,"65":0,"66":0,"67":0,"68":176,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":176,"84":0,"85":0,"86":0,"87":176,"88":176,"89":176,"90":0,"91":0,"92":176,"93":176,"94":176,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":176,"103":176,"104":0,"105":0,"106":0,"107":0,"108":176,"109":0,"110":0,"111":176,"112":176,"113":0,"114":176,"115":0,"116":176,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":176,"128":0,"129":176,"130":0,"131":176,"132":176,"133":176,"134":0,"135":176,"136":176,"137":0,"138":176,"139":176,"140":0,"141":176,"142":0,"143":0,"144":176,"145":0,"146":0,"147":0,"148":0,"149":0,"150":0,"151":0,"152":176,"153":0,"154":0,"155":0,"156":176,"157":176,"158":176,"159":0,"160":0,"161":0,"162":0,"163":0,"164":176,"165":176,"166":0,"167":0,"168":0,"169":0,"170":0,"171":0,"172":0,"173":0,"174":0,"175":0,"176":0,"177":176,"178":176,"179":219,"180":0,"181":178,"182":176,"183":177,"184":177,"185":177,"186":0,"187":0,"188":176,"189":0,"190":0,"191":0,"192":0,"193":0,"194":0,"195":176,"196":176,"197":0,"198":0,"199":0,"200":0,"201":0,"202":176,"203":176,"204":219,"205":0,"206":177,"207":177,"208":176,"209":176,"210":219,"211":0,"212":177,"213":177,"214":177,"215":177,"216":0,"217":0,"218":176,"219":176,"220":176,"221":0,"222":0,"223":0,"224":0,"225":176,"226":176,"227":176,"228":176,"229":0,"230":178,"231":177,"232":176,"233":177,"234":0,"235":177,"236":177,"237":178,"238":0,"239":0,"240":0,"241":0,"242":178,"243":178,"244":176,"245":0,"246":176,"247":0,"248":0,"249":0,"250":0,"251":176,"252":0,"253":176,"254":0,"255":0,"256":0,"257":0,"258":178,"259":0,"260":219,"261":178,"262":0,"263":0,"264":0,"265":177,"266":178,"267":176,"268":176,"269":0,"270":0,"271":176,"272":0,"273":0,"274":0,"275":0,"276":176,"277":0,"278":0,"279":0,"280":0,"281":0,"282":0,"283":178,"284":178,"285":178,"286":178,"287":0,"288":177,"289":177,"290":178,"291":0,"292":176,"293":219,"294":0,"295":0,"296":0,"297":0,"298":0,"299":0,"300":0,"301":176,"302":0,"303":0,"304":0,"305":178,"306":0,"307":0,"308":0,"309":178,"310":0,"311":0,"312":177,"313":177,"314":0,"315":0,"316":0,"317":176,"318":0,"319":0,"320":176,"321":0,"322":0,"323":0,"324":0,"325":0,"326":0,"327":0,"328":0,"329":178,"330":0,"331":178,"332":178,"333":178,"334":178,"335":0,"336":178,"337":0,"338":0,"339":0,"340":0,"341":0,"342":219,"343":0,"344":0,"345":0,"346":0,"347":176,"348":0,"349":0,"350":0,"351":0,"352":0,"353":0,"354":0,"355":0,"356":0,"357":0,"358":219,"359":219,"360":0,"361":178,"362":0,"363":0,"364":0,"365":0,"366":0,"367":219,"368":0,"369":0,"370":176,"371":176,"372":176,"373":0,"374":0,"375":0,"376":178,"377":0,"378":0,"379":178,"380":0,"381":0,"382":0,"383":0,"384":178,"385":178,"386":0,"387":0,"388":0,"389":0,"390":178,"391":178,"392":0,"393":0,"394":0,"395":176,"396":0,"397":176,"398":176,"399":0,"400":0,"401":178,"402":219,"403":178,"404":0,"405":0,"406":0,"407":178,"408":178,"409":0,"410":0,"411":0,"412":0,"413":178,"414":178,"415":0,"416":0,"417":0,"418":178,"419":178,"420":176,"421":178,"422":178,"423":0,"424":0,"425":0,"426":178,"427":219,"428":178,"429":0,"430":0,"431":0,"432":0,"433":0,"434":0,"435":0,"436":0,"437":0,"438":178,"439":178,"440":178,"441":178,"442":178,"443":0,"444":177,"445":219,"446":0,"447":0,"448":176,"449":0,"450":0,"451":178,"452":219,"453":178,"454":0,"455":0,"456":219,"457":219,"458":219,"459":219,"460":219,"461":0,"462":0,"463":178,"464":178,"465":0,"466":0,"467":0,"468":219,"469":177,"470":0,"471":0,"472":0,"473":176,"474":0,"475":0,"476":178,"477":0,"478":219,"479":0,"480":219,"481":219,"482":219,"483":219,"484":219,"485":219,"486":219,"487":219,"488":0,"489":0,"490":219,"491":219,"492":219,"493":0,"494":177,"495":177,"496":0,"497":0,"498":176,"499":0,"500":0,"501":178,"502":0,"503":0,"504":0,"505":219,"506":219,"507":219,"508":219,"509":219,"510":219,"511":219,"512":219,"513":219,"514":219,"515":219,"516":219,"517":219,"518":0,"519":0,"520":177,"521":177,"522":0,"523":176,"524":0,"525":0,"526":178,"527":0,"528":0,"529":219,"530":219,"531":219,"532":219,"533":219,"534":219,"535":219,"536":219,"537":219,"538":219,"539":219,"540":0,"541":219,"542":219,"543":219,"544":219,"545":177,"546":177,"547":178,"548":176,"549":0,"550":178,"551":178,"552":0,"553":219,"554":219,"555":219,"556":219,"557":0,"558":219,"559":219,"560":0,"561":219,"562":0,"563":219,"564":0,"565":0,"566":0,"567":219,"568":0,"569":219,"570":0,"571":177,"572":178,"573":176,"574":0,"575":0,"576":178,"577":0,"578":219,"579":219,"580":0,"581":0,"582":219,"583":219,"584":0,"585":0,"586":219,"587":219,"588":219,"589":219,"590":219,"591":219,"592":219,"593":219,"594":219,"595":0,"596":178,"597":0,"598":176,"599":0,"600":0,"601":178,"602":219,"603":219,"604":219,"605":0,"606":219,"607":0,"608":0,"609":0,"610":0,"611":0,"612":0,"613":0,"614":219,"615":219,"616":219,"617":219,"618":219,"619":219,"620":219,"621":0,"622":177,"623":176,"624":0,"625":178,"626":0,"627":219,"628":219,"629":0,"630":219,"631":0,"632":0,"633":0,"634":0,"635":0,"636":0,"637":0,"638":0,"639":0,"640":0,"641":219,"642":219,"643":219,"644":219,"645":219,"646":0,"647":177,"648":176,"649":0,"650":178,"651":0,"652":219,"653":219,"654":219,"655":0,"656":0,"657":0,"658":0,"659":0,"660":0,"661":0,"662":0,"663":0,"664":0,"665":0,"666":219,"667":219,"668":219,"669":219,"670":219,"671":0,"672":219,"673":176,"674":0,"675":0,"676":0,"677":219,"678":219,"679":0,"680":0,"681":0,"682":0,"683":0,"684":0,"685":0,"686":0,"687":0,"688":0,"689":0,"690":219,"691":219,"692":219,"693":219,"694":219,"695":219,"696":178,"697":178,"698":219,"699":0,"700":0,"701":0,"702":219,"703":219,"704":0,"705":0,"706":0,"707":0,"708":0,"709":0,"710":0,"711":0,"712":0,"713":0,"714":0,"715":219,"716":219,"717":219,"718":219,"719":219,"720":219,"721":219,"722":178,"723":178,"724":0,"725":0,"726":0,"727":219,"728":0,"729":0,"730":0,"731":0,"732":0,"733":0,"734":0,"735":0,"736":0,"737":0,"738":0,"739":0,"740":219,"741":219,"742":219,"743":219,"744":219,"745":219,"746":219,"747":176,"748":0,"749":0,"750":0,"751":219,"752":219,"753":0,"754":0,"755":0,"756":0,"757":0,"758":0,"759":0,"760":0,"761":0,"762":0,"763":0,"764":219,"765":219,"766":219,"767":219,"768":219,"769":219,"770":219,"771":219,"772":176,"773":0,"774":0,"775":178,"776":219,"777":219,"778":0,"779":0,"780":0,"781":0,"782":0,"783":0,"784":0,"785":0,"786":0,"787":0,"788":0,"789":219,"790":219,"791":219,"792":219,"793":0,"794":0,"795":219,"796":0,"797":176,"798":0,"799":0,"800":0,"801":219,"802":219,"803":0,"804":0,"805":0,"806":0,"807":0,"808":0,"809":0,"810":0,"811":0,"812":0,"813":219,"814":219,"815":219,"816":219,"817":219,"818":0,"819":0,"820":219,"821":219,"822":0,"823":0,"824":0,"825":0,"826":219,"827":0,"828":0,"829":0,"830":0,"831":0,"832":0,"833":0,"834":0,"835":0,"836":0,"837":0,"838":219,"839":219,"840":219,"841":219,"842":219,"843":219,"844":0,"845":219,"846":219,"847":0,"848":178,"849":0,"850":0,"851":219,"852":0,"853":0,"854":0,"855":0,"856":0,"857":0,"858":0,"859":0,"860":0,"861":0,"862":0,"863":219,"864":219,"865":219,"866":219,"867":219,"868":219,"869":219,"870":219,"871":219,"872":0,"873":178,"874":0,"875":0,"876":219,"877":0,"878":0,"879":0,"880":0,"881":0,"882":0,"883":0,"884":219,"885":219,"886":219,"887":219,"888":219,"889":219,"890":219,"891":219,"892":219,"893":219,"894":219,"895":219,"896":219,"897":0,"898":178,"899":0,"900":0,"901":219,"902":0,"903":0,"904":0,"905":0,"906":0,"907":0,"908":0,"909":219,"910":219,"911":219,"912":219,"913":219,"914":219,"915":219,"916":219,"917":219,"918":219,"919":219,"920":219,"921":219,"922":0,"923":178,"924":0,"925":219,"926":219,"927":0,"928":0,"929":0,"930":0,"931":0,"932":219,"933":219,"934":219,"935":219,"936":219,"937":219,"938":219,"939":219,"940":219,"941":219,"942":219,"943":219,"944":219,"945":219,"946":219,"947":0,"948":178,"949":0,"950":219,"951":219,"952":0,"953":0,"954":0,"955":0,"956":0,"957":219,"958":219,"959":219,"960":219,"961":219,"962":219,"963":219,"964":219,"965":219,"966":219,"967":219,"968":219,"969":219,"970":219,"971":219,"972":176,"973":176,"974":0,"975":219,"976":0,"977":0,"978":0,"979":0,"980":0,"981":0,"982":219,"983":219,"984":219,"985":219,"986":219,"987":219,"988":219,"989":219,"990":219,"991":219,"992":219,"993":219,"994":219,"995":219,"996":219,"997":219,"998":176,"999":0,"1000":219,"1001":0,"1002":0,"1003":0,"1004":0,"1005":0,"1006":0,"1007":219,"1008":219,"1009":219,"1010":219,"1011":219,"1012":219,"1013":219,"1014":219,"1015":219,"1016":219,"1017":219,"1018":219,"1019":219,"1020":219,"1021":219,"1022":219,"1023":0,"1024":0,"1025":219,"1026":0,"1027":0,"1028":0,"1029":0,"1030":0,"1031":0,"1032":219,"1033":219,"1034":219,"1035":219,"1036":219,"1037":219,"1038":219,"1039":219,"1040":219,"1041":219,"1042":219,"1043":219,"1044":219,"1045":219,"1046":219,"1047":219,"1048":0,"1049":0,"1050":219,"1051":0,"1052":0,"1053":0,"1054":0,"1055":0,"1056":0,"1057":219,"1058":219,"1059":219,"1060":219,"1061":219,"1062":219,"1063":219,"1064":219,"1065":219,"1066":219,"1067":219,"1068":219,"1069":219,"1070":219,"1071":219,"1072":219,"1073":0,"1074":0,"1075":219,"1076":0,"1077":0,"1078":0,"1079":0,"1080":0,"1081":0,"1082":219,"1083":219,"1084":219,"1085":219,"1086":219,"1087":219,"1088":219,"1089":219,"1090":219,"1091":219,"1092":219,"1093":219,"1094":219,"1095":219,"1096":219,"1097":219,"1098":0,"1099":0,"1100":219,"1101":0,"1102":0,"1103":0,"1104":0,"1105":0,"1106":0,"1107":219,"1108":219,"1109":219,"1110":219,"1111":219,"1112":219,"1113":219,"1114":219,"1115":219,"1116":219,"1117":219,"1118":219,"1119":219,"1120":219,"1121":219,"1122":0,"1123":219,"1124":0,"1125":219,"1126":0,"1127":0,"1128":0,"1129":0,"1130":0,"1131":0,"1132":219,"1133":219,"1134":219,"1135":219,"1136":219,"1137":219,"1138":219,"1139":219,"1140":219,"1141":219,"1142":219,"1143":219,"1144":219,"1145":219,"1146":219,"1147":0,"1148":219,"1149":0,"1150":219,"1151":0,"1152":0,"1153":0,"1154":0,"1155":0,"1156":0,"1157":0,"1158":219,"1159":219,"1160":219,"1161":219,"1162":219,"1163":219,"1164":219,"1165":219,"1166":219,"1167":219,"1168":219,"1169":219,"1170":219,"1171":0,"1172":0,"1173":0,"1174":0,"1175":219,"1176":219,"1177":0,"1178":0,"1179":0,"1180":0,"1181":0,"1182":0,"1183":0,"1184":219,"1185":219,"1186":219,"1187":219,"1188":219,"1189":219,"1190":219,"1191":219,"1192":219,"1193":219,"1194":219,"1195":219,"1196":177,"1197":178,"1198":219,"1199":0,"1200":219,"1201":219,"1202":0,"1203":0,"1204":0,"1205":0,"1206":0,"1207":0,"1208":0,"1209":0,"1210":0,"1211":0,"1212":0,"1213":219,"1214":219,"1215":219,"1216":219,"1217":219,"1218":0,"1219":219,"1220":219,"1221":177,"1222":178,"1223":0,"1224":0,"1225":219,"1226":219,"1227":0,"1228":0,"1229":0,"1230":0,"1231":0,"1232":0,"1233":0,"1234":0,"1235":0,"1236":0,"1237":0,"1238":219,"1239":219,"1240":219,"1241":219,"1242":219,"1243":219,"1244":219,"1245":219,"1246":177,"1247":178,"1248":0,"1249":0,"1250":219,"1251":219,"1252":0,"1253":0,"1254":0,"1255":0,"1256":0,"1257":0,"1258":0,"1259":0,"1260":0,"1261":0,"1262":0,"1263":219,"1264":219,"1265":219,"1266":219,"1267":219,"1268":219,"1269":219,"1270":219,"1271":177,"1272":0,"1273":0,"1274":0,"1275":219,"1276":219,"1277":0,"1278":0,"1279":0,"1280":0,"1281":0,"1282":0,"1283":0,"1284":0,"1285":0,"1286":0,"1287":0,"1288":219,"1289":219,"1290":219,"1291":219,"1292":219,"1293":219,"1294":219,"1295":0,"1296":177,"1297":0,"1298":178,"1299":0,"1300":219,"1301":219,"1302":0,"1303":0,"1304":0,"1305":0,"1306":0,"1307":0,"1308":0,"1309":0,"1310":0,"1311":0,"1312":0,"1313":219,"1314":219,"1315":219,"1316":219,"1317":219,"1318":219,"1319":219,"1320":0,"1321":177,"1322":0,"1323":178,"1324":0,"1325":219,"1326":219,"1327":0,"1328":0,"1329":0,"1330":0,"1331":0,"1332":0,"1333":0,"1334":0,"1335":0,"1336":0,"1337":0,"1338":219,"1339":219,"1340":219,"1341":219,"1342":219,"1343":219,"1344":219,"1345":0,"1346":177,"1347":0,"1348":0,"1349":0,"1350":0,"1351":219,"1352":0,"1353":0,"1354":0,"1355":0,"1356":0,"1357":0,"1358":0,"1359":0,"1360":0,"1361":0,"1362":0,"1363":0,"1364":219,"1365":219,"1366":219,"1367":219,"1368":219,"1369":219,"1370":177,"1371":0,"1372":0,"1373":178,"1374":0,"1375":219,"1376":219,"1377":0,"1378":0,"1379":0,"1380":0,"1381":0,"1382":0,"1383":0,"1384":0,"1385":0,"1386":0,"1387":0,"1388":0,"1389":0,"1390":219,"1391":219,"1392":219,"1393":219,"1394":219,"1395":0,"1396":0,"1397":0,"1398":178,"1399":0,"1400":219,"1401":219,"1402":0,"1403":0,"1404":0,"1405":0,"1406":0,"1407":0,"1408":0,"1409":0,"1410":0,"1411":0,"1412":0,"1413":0,"1414":0,"1415":219,"1416":219,"1417":219,"1418":219,"1419":0,"1420":0,"1421":219,"1422":219,"1423":0,"1424":0,"1425":219,"1426":219,"1427":0,"1428":0,"1429":0,"1430":0,"1431":0,"1432":0,"1433":0,"1434":0,"1435":0,"1436":0,"1437":0,"1438":0,"1439":0,"1440":0,"1441":219,"1442":219,"1443":219,"1444":0,"1445":178,"1446":0,"1447":219,"1448":0,"1449":176,"1450":219,"1451":219,"1452":219,"1453":0,"1454":0,"1455":0,"1456":0,"1457":0,"1458":0,"1459":0,"1460":0,"1461":0,"1462":0,"1463":0,"1464":0,"1465":0,"1466":219,"1467":219,"1468":219,"1469":0,"1470":178,"1471":0,"1472":219,"1473":176,"1474":176,"1475":219,"1476":219,"1477":219,"1478":0,"1479":0,"1480":0,"1481":0,"1482":0,"1483":0,"1484":0,"1485":0,"1486":0,"1487":0,"1488":0,"1489":0,"1490":0,"1491":0,"1492":219,"1493":219,"1494":0,"1495":178,"1496":178,"1497":0,"1498":176,"1499":0,"1500":219,"1501":219,"1502":219,"1503":0,"1504":0,"1505":0,"1506":0,"1507":0,"1508":0,"1509":0,"1510":0,"1511":0,"1512":0,"1513":0,"1514":0,"1515":0,"1516":219,"1517":0,"1518":0,"1519":177,"1520":0,"1521":178,"1522":0,"1523":176,"1524":0,"1525":219,"1526":219,"1527":219,"1528":219,"1529":219,"1530":0,"1531":0,"1532":0,"1533":0,"1534":0,"1535":0,"1536":0,"1537":0,"1538":0,"1539":0,"1540":0,"1541":219,"1542":219,"1543":219,"1544":177,"1545":178,"1546":0,"1547":0,"1548":0,"1549":0,"1550":219,"1551":219,"1552":219,"1553":219,"1554":0,"1555":0,"1556":0,"1557":0,"1558":0,"1559":0,"1560":0,"1561":0,"1562":0,"1563":0,"1564":0,"1565":219,"1566":219,"1567":0,"1568":177,"1569":0,"1570":178,"1571":0,"1572":178,"1573":176,"1574":0,"1575":219,"1576":219,"1577":219,"1578":219,"1579":219,"1580":219,"1581":0,"1582":0,"1583":0,"1584":0,"1585":0,"1586":0,"1587":0,"1588":0,"1589":219,"1590":219,"1591":0,"1592":219,"1593":177,"1594":0,"1595":219,"1596":178,"1597":178,"1598":176,"1599":0,"1600":0,"1601":219,"1602":219,"1603":219,"1604":219,"1605":219,"1606":219,"1607":0,"1608":0,"1609":0,"1610":0,"1611":0,"1612":0,"1613":0,"1614":219,"1615":219,"1616":0,"1617":0,"1618":177,"1619":0,"1620":219,"1621":178,"1622":0,"1623":0,"1624":0,"1625":219,"1626":219,"1627":219,"1628":219,"1629":219,"1630":219,"1631":219,"1632":219,"1633":219,"1634":0,"1635":0,"1636":0,"1637":0,"1638":219,"1639":219,"1640":219,"1641":0,"1642":177,"1643":0,"1644":0,"1645":219,"1646":0,"1647":0,"1648":176,"1649":0,"1650":0,"1651":219,"1652":219,"1653":219,"1654":0,"1655":219,"1656":219,"1657":219,"1658":219,"1659":219,"1660":0,"1661":0,"1662":0,"1663":219,"1664":219,"1665":0,"1666":178,"1667":177,"1668":178,"1669":178,"1670":178,"1671":178,"1672":178,"1673":176,"1674":0,"1675":0,"1676":178,"1677":0,"1678":0,"1679":0,"1680":219,"1681":219,"1682":219,"1683":219,"1684":219,"1685":219,"1686":219,"1687":219,"1688":219,"1689":0,"1690":178,"1691":178,"1692":0,"1693":0,"1694":178,"1695":0,"1696":0,"1697":0,"1698":176,"1699":0,"1700":178,"1701":178,"1702":0,"1703":0,"1704":219,"1705":219,"1706":219,"1707":0,"1708":0,"1709":219,"1710":219,"1711":219,"1712":219,"1713":0,"1714":0,"1715":178,"1716":177,"1717":177,"1718":0,"1719":178,"1720":0,"1721":219,"1722":176,"1723":0,"1724":0,"1725":178,"1726":0,"1727":0,"1728":0,"1729":0,"1730":219,"1731":0,"1732":219,"1733":0,"1734":0,"1735":0,"1736":219,"1737":0,"1738":0,"1739":178,"1740":178,"1741":177,"1742":177,"1743":178,"1744":178,"1745":0,"1746":219,"1747":176,"1748":0,"1749":0,"1750":178,"1751":0,"1752":0,"1753":178,"1754":178,"1755":0,"1756":219,"1757":219,"1758":219,"1759":219,"1760":0,"1761":0,"1762":0,"1763":0,"1764":0,"1765":0,"1766":177,"1767":0,"1768":219,"1769":0,"1770":0,"1771":0,"1772":176,"1773":0,"1774":0,"1775":0,"1776":0,"1777":0,"1778":178,"1779":0,"1780":0,"1781":219,"1782":219,"1783":0,"1784":0,"1785":178,"1786":0,"1787":0,"1788":0,"1789":177,"1790":177,"1791":178,"1792":0,"1793":219,"1794":0,"1795":0,"1796":176,"1797":176,"1798":0,"1799":0,"1800":0,"1801":0,"1802":0,"1803":178,"1804":0,"1805":219,"1806":219,"1807":0,"1808":0,"1809":178,"1810":0,"1811":178,"1812":178,"1813":178,"1814":0,"1815":0,"1816":178,"1817":0,"1818":0,"1819":0,"1820":0,"1821":176,"1822":176,"1823":0,"1824":0,"1825":0,"1826":0,"1827":0,"1828":0,"1829":219,"1830":176,"1831":176,"1832":0,"1833":0,"1834":0,"1835":178,"1836":0,"1837":219,"1838":177,"1839":0,"1840":178,"1841":0,"1842":0,"1843":0,"1844":176,"1845":176,"1846":0,"1847":0,"1848":0,"1849":0,"1850":0,"1851":0,"1852":178,"1853":176,"1854":176,"1855":0,"1856":176,"1857":0,"1858":0,"1859":0,"1860":178,"1861":177,"1862":177,"1863":0,"1864":177,"1865":176,"1866":176,"1867":0,"1868":176,"1869":0,"1870":0,"1871":0,"1872":0,"1873":0,"1874":0,"1875":0,"1876":0,"1877":178,"1878":0,"1879":0,"1880":0,"1881":0,"1882":0,"1883":178,"1884":177,"1885":177,"1886":177,"1887":0,"1888":177,"1889":177,"1890":176,"1891":0,"1892":0,"1893":0,"1894":0,"1895":0,"1896":0,"1897":176,"1898":176,"1899":0,"1900":0,"1901":0,"1902":177,"1903":177,"1904":177,"1905":0,"1906":0,"1907":177,"1908":177,"1909":0,"1910":177,"1911":0,"1912":177,"1913":176,"1914":176,"1915":176,"1916":0,"1917":0,"1918":0,"1919":0,"1920":0,"1921":0,"1922":0,"1923":0,"1924":0,"1925":0,"1926":0,"1927":176,"1928":176,"1929":177,"1930":176,"1931":177,"1932":177,"1933":177,"1934":177,"1935":0,"1936":0,"1937":0,"1938":176,"1939":0,"1940":0,"1941":0,"1942":0,"1943":0,"1944":0,"1945":0,"1946":0,"1947":0,"1948":0,"1949":0,"1950":0,"1951":178,"1952":0,"1953":0,"1954":0,"1955":0,"1956":0,"1957":0,"1958":0,"1959":0,"1960":0,"1961":0,"1962":176,"1963":0,"1964":0,"1965":0,"1966":0,"1967":0,"1968":0,"1969":0,"1970":0,"1971":0,"1972":0,"1973":0,"1974":0,"1975":0,"1976":0,"1977":0,"1978":0,"1979":176,"1980":0,"1981":176,"1982":176,"1983":176,"1984":176,"1985":176,"1986":176,"1987":0,"1988":0,"1989":0,"1990":0,"1991":0,"1992":0,"1993":0,"1994":0,"1995":0,"1996":0,"1997":0,"1998":0,"1999":0,"2000":0,"2001":0,"2002":0,"2003":0,"2004":0,"2005":0,"2006":0,"2007":0,"2008":0,"2009":0,"2010":0,"2011":0,"2012":0,"2013":0,"2014":0,"2015":0,"2016":0,"2017":0,"2018":0,"2019":0,"2020":0,"2021":0,"2022":0,"2023":0,"2024":0,"2025":0,"2026":0,"2027":0,"2028":0,"2029":0,"2030":0,"2031":0,"2032":0,"2033":67,"2034":0,"2035":0,"2036":0,"2037":0,"2038":0,"2039":0,"2040":0,"2041":0,"2042":0,"2043":0,"2044":0,"2045":0,"2046":0,"2047":0,"2048":0,"2049":0,"2050":0,"2051":0,"2052":0,"2053":0,"2054":0,"2055":0,"2056":0,"2057":0,"2058":67,"2059":0,"2060":0,"2061":0,"2062":67,"2063":67,"2064":67,"2065":0,"2066":0,"2067":0,"2068":67,"2069":0,"2070":0,"2071":0,"2072":0,"2073":0,"2074":0,"2075":0,"2076":0,"2077":0,"2078":0,"2079":0,"2080":0,"2081":0,"2082":0,"2083":67,"2084":0,"2085":0,"2086":0,"2087":67,"2088":67,"2089":67,"2090":0,"2091":0,"2092":67,"2093":67,"2094":67,"2095":0,"2096":0,"2097":0,"2098":0,"2099":0,"2100":0,"2101":0,"2102":67,"2103":67,"2104":0,"2105":0,"2106":0,"2107":0,"2108":67,"2109":0,"2110":0,"2111":67,"2112":67,"2113":0,"2114":67,"2115":0,"2116":67,"2117":0,"2118":0,"2119":0,"2120":0,"2121":0,"2122":0,"2123":0,"2124":0,"2125":0,"2126":0,"2127":67,"2128":0,"2129":67,"2130":0,"2131":67,"2132":67,"2133":67,"2134":0,"2135":67,"2136":67,"2137":0,"2138":67,"2139":67,"2140":0,"2141":67,"2142":0,"2143":0,"2144":67,"2145":0,"2146":0,"2147":0,"2148":0,"2149":0,"2150":0,"2151":0,"2152":67,"2153":0,"2154":0,"2155":0,"2156":67,"2157":67,"2158":67,"2159":0,"2160":0,"2161":0,"2162":0,"2163":0,"2164":67,"2165":67,"2166":0,"2167":0,"2168":0,"2169":0,"2170":0,"2171":0,"2172":0,"2173":0,"2174":0,"2175":0,"2176":0,"2177":67,"2178":67,"2179":67,"2180":0,"2181":67,"2182":67,"2183":67,"2184":67,"2185":67,"2186":0,"2187":0,"2188":67,"2189":0,"2190":0,"2191":0,"2192":0,"2193":0,"2194":0,"2195":67,"2196":67,"2197":0,"2198":0,"2199":0,"2200":0,"2201":0,"2202":67,"2203":67,"2204":67,"2205":0,"2206":67,"2207":67,"2208":67,"2209":67,"2210":67,"2211":0,"2212":67,"2213":67,"2214":67,"2215":67,"2216":0,"2217":0,"2218":67,"2219":67,"2220":67,"2221":0,"2222":0,"2223":0,"2224":0,"2225":67,"2226":67,"2227":67,"2228":67,"2229":0,"2230":67,"2231":67,"2232":67,"2233":67,"2234":0,"2235":67,"2236":67,"2237":67,"2238":0,"2239":0,"2240":0,"2241":0,"2242":67,"2243":67,"2244":67,"2245":0,"2246":67,"2247":0,"2248":0,"2249":0,"2250":0,"2251":67,"2252":0,"2253":67,"2254":0,"2255":0,"2256":0,"2257":0,"2258":67,"2259":0,"2260":67,"2261":67,"2262":0,"2263":0,"2264":0,"2265":67,"2266":67,"2267":67,"2268":67,"2269":0,"2270":0,"2271":67,"2272":0,"2273":0,"2274":0,"2275":0,"2276":67,"2277":0,"2278":0,"2279":0,"2280":0,"2281":0,"2282":0,"2283":67,"2284":67,"2285":67,"2286":67,"2287":0,"2288":67,"2289":67,"2290":67,"2291":0,"2292":67,"2293":67,"2294":0,"2295":0,"2296":0,"2297":0,"2298":0,"2299":0,"2300":0,"2301":67,"2302":0,"2303":0,"2304":0,"2305":67,"2306":0,"2307":0,"2308":0,"2309":67,"2310":0,"2311":0,"2312":67,"2313":67,"2314":0,"2315":0,"2316":0,"2317":67,"2318":0,"2319":0,"2320":67,"2321":0,"2322":0,"2323":0,"2324":0,"2325":0,"2326":0,"2327":0,"2328":0,"2329":67,"2330":0,"2331":67,"2332":67,"2333":67,"2334":67,"2335":0,"2336":67,"2337":0,"2338":0,"2339":0,"2340":0,"2341":0,"2342":67,"2343":0,"2344":0,"2345":0,"2346":0,"2347":67,"2348":0,"2349":0,"2350":0,"2351":0,"2352":0,"2353":0,"2354":0,"2355":0,"2356":0,"2357":0,"2358":67,"2359":67,"2360":0,"2361":67,"2362":0,"2363":0,"2364":0,"2365":0,"2366":0,"2367":67,"2368":0,"2369":0,"2370":67,"2371":67,"2372":67,"2373":0,"2374":0,"2375":0,"2376":67,"2377":0,"2378":0,"2379":67,"2380":0,"2381":0,"2382":0,"2383":0,"2384":67,"2385":67,"2386":0,"2387":0,"2388":0,"2389":0,"2390":67,"2391":67,"2392":0,"2393":0,"2394":0,"2395":67,"2396":0,"2397":67,"2398":67,"2399":0,"2400":0,"2401":67,"2402":67,"2403":67,"2404":0,"2405":0,"2406":0,"2407":67,"2408":67,"2409":0,"2410":0,"2411":0,"2412":0,"2413":67,"2414":67,"2415":0,"2416":0,"2417":0,"2418":67,"2419":67,"2420":67,"2421":67,"2422":67,"2423":0,"2424":0,"2425":0,"2426":67,"2427":67,"2428":67,"2429":0,"2430":0,"2431":0,"2432":0,"2433":0,"2434":0,"2435":0,"2436":0,"2437":0,"2438":67,"2439":67,"2440":67,"2441":67,"2442":67,"2443":0,"2444":67,"2445":67,"2446":0,"2447":0,"2448":67,"2449":0,"2450":0,"2451":67,"2452":67,"2453":67,"2454":0,"2455":0,"2456":67,"2457":67,"2458":67,"2459":67,"2460":67,"2461":0,"2462":0,"2463":67,"2464":67,"2465":0,"2466":0,"2467":0,"2468":67,"2469":67,"2470":0,"2471":0,"2472":0,"2473":67,"2474":0,"2475":0,"2476":67,"2477":0,"2478":67,"2479":0,"2480":67,"2481":67,"2482":67,"2483":67,"2484":67,"2485":67,"2486":67,"2487":67,"2488":0,"2489":0,"2490":67,"2491":67,"2492":67,"2493":0,"2494":67,"2495":67,"2496":0,"2497":0,"2498":67,"2499":0,"2500":0,"2501":67,"2502":0,"2503":0,"2504":0,"2505":67,"2506":67,"2507":67,"2508":67,"2509":67,"2510":67,"2511":67,"2512":67,"2513":67,"2514":67,"2515":67,"2516":67,"2517":67,"2518":0,"2519":0,"2520":67,"2521":67,"2522":0,"2523":67,"2524":0,"2525":0,"2526":67,"2527":0,"2528":0,"2529":67,"2530":67,"2531":67,"2532":67,"2533":67,"2534":67,"2535":67,"2536":67,"2537":67,"2538":67,"2539":67,"2540":0,"2541":67,"2542":67,"2543":67,"2544":67,"2545":67,"2546":67,"2547":67,"2548":67,"2549":0,"2550":67,"2551":67,"2552":0,"2553":67,"2554":67,"2555":67,"2556":67,"2557":0,"2558":67,"2559":67,"2560":0,"2561":67,"2562":0,"2563":67,"2564":0,"2565":0,"2566":0,"2567":7,"2568":0,"2569":67,"2570":0,"2571":67,"2572":67,"2573":67,"2574":0,"2575":0,"2576":67,"2577":0,"2578":67,"2579":67,"2580":0,"2581":0,"2582":67,"2583":67,"2584":0,"2585":0,"2586":67,"2587":67,"2588":67,"2589":67,"2590":67,"2591":67,"2592":7,"2593":67,"2594":67,"2595":0,"2596":67,"2597":0,"2598":67,"2599":0,"2600":0,"2601":67,"2602":67,"2603":67,"2604":67,"2605":0,"2606":67,"2607":0,"2608":0,"2609":0,"2610":0,"2611":0,"2612":0,"2613":0,"2614":67,"2615":67,"2616":7,"2617":7,"2618":7,"2619":7,"2620":67,"2621":0,"2622":67,"2623":67,"2624":0,"2625":67,"2626":0,"2627":67,"2628":67,"2629":0,"2630":67,"2631":0,"2632":0,"2633":0,"2634":0,"2635":0,"2636":0,"2637":0,"2638":0,"2639":0,"2640":0,"2641":7,"2642":7,"2643":7,"2644":67,"2645":67,"2646":0,"2647":67,"2648":67,"2649":0,"2650":67,"2651":0,"2652":67,"2653":67,"2654":67,"2655":0,"2656":0,"2657":0,"2658":0,"2659":0,"2660":0,"2661":0,"2662":0,"2663":0,"2664":0,"2665":0,"2666":7,"2667":7,"2668":7,"2669":67,"2670":67,"2671":0,"2672":67,"2673":67,"2674":0,"2675":0,"2676":0,"2677":67,"2678":67,"2679":0,"2680":0,"2681":0,"2682":0,"2683":0,"2684":0,"2685":0,"2686":0,"2687":0,"2688":0,"2689":0,"2690":7,"2691":7,"2692":7,"2693":7,"2694":7,"2695":7,"2696":67,"2697":67,"2698":67,"2699":0,"2700":0,"2701":0,"2702":67,"2703":67,"2704":0,"2705":0,"2706":0,"2707":0,"2708":0,"2709":0,"2710":0,"2711":0,"2712":0,"2713":0,"2714":0,"2715":7,"2716":7,"2717":7,"2718":7,"2719":7,"2720":7,"2721":67,"2722":67,"2723":67,"2724":0,"2725":0,"2726":0,"2727":67,"2728":0,"2729":0,"2730":0,"2731":0,"2732":0,"2733":0,"2734":0,"2735":0,"2736":0,"2737":0,"2738":0,"2739":0,"2740":7,"2741":7,"2742":7,"2743":7,"2744":67,"2745":67,"2746":67,"2747":67,"2748":0,"2749":0,"2750":0,"2751":67,"2752":67,"2753":0,"2754":0,"2755":0,"2756":0,"2757":0,"2758":0,"2759":0,"2760":0,"2761":0,"2762":0,"2763":0,"2764":7,"2765":7,"2766":7,"2767":7,"2768":7,"2769":7,"2770":67,"2771":67,"2772":67,"2773":0,"2774":0,"2775":67,"2776":67,"2777":67,"2778":0,"2779":0,"2780":0,"2781":0,"2782":0,"2783":0,"2784":0,"2785":0,"2786":7,"2787":7,"2788":0,"2789":7,"2790":7,"2791":7,"2792":7,"2793":7,"2794":7,"2795":67,"2796":0,"2797":67,"2798":0,"2799":0,"2800":0,"2801":67,"2802":67,"2803":0,"2804":0,"2805":0,"2806":0,"2807":0,"2808":0,"2809":0,"2810":0,"2811":7,"2812":7,"2813":7,"2814":7,"2815":7,"2816":7,"2817":7,"2818":7,"2819":7,"2820":67,"2821":67,"2822":0,"2823":0,"2824":0,"2825":0,"2826":67,"2827":0,"2828":0,"2829":0,"2830":0,"2831":0,"2832":0,"2833":0,"2834":0,"2835":0,"2836":7,"2837":7,"2838":7,"2839":7,"2840":7,"2841":7,"2842":7,"2843":7,"2844":7,"2845":67,"2846":67,"2847":0,"2848":67,"2849":0,"2850":0,"2851":67,"2852":0,"2853":0,"2854":0,"2855":0,"2856":0,"2857":0,"2858":0,"2859":0,"2860":0,"2861":7,"2862":71,"2863":7,"2864":7,"2865":7,"2866":7,"2867":7,"2868":7,"2869":7,"2870":67,"2871":67,"2872":0,"2873":67,"2874":0,"2875":0,"2876":67,"2877":0,"2878":0,"2879":0,"2880":0,"2881":0,"2882":0,"2883":0,"2884":71,"2885":71,"2886":71,"2887":71,"2888":71,"2889":71,"2890":7,"2891":7,"2892":7,"2893":7,"2894":7,"2895":67,"2896":67,"2897":0,"2898":67,"2899":0,"2900":0,"2901":67,"2902":0,"2903":0,"2904":0,"2905":0,"2906":0,"2907":0,"2908":0,"2909":71,"2910":71,"2911":71,"2912":71,"2913":71,"2914":71,"2915":71,"2916":71,"2917":7,"2918":7,"2919":7,"2920":67,"2921":67,"2922":0,"2923":67,"2924":0,"2925":67,"2926":67,"2927":0,"2928":0,"2929":0,"2930":0,"2931":0,"2932":71,"2933":71,"2934":71,"2935":71,"2936":7,"2937":7,"2938":7,"2939":71,"2940":71,"2941":71,"2942":71,"2943":71,"2944":71,"2945":67,"2946":67,"2947":0,"2948":67,"2949":0,"2950":67,"2951":67,"2952":0,"2953":0,"2954":0,"2955":0,"2956":0,"2957":71,"2958":71,"2959":71,"2960":7,"2961":7,"2962":7,"2963":7,"2964":71,"2965":71,"2966":71,"2967":71,"2968":71,"2969":71,"2970":71,"2971":71,"2972":67,"2973":67,"2974":0,"2975":67,"2976":0,"2977":0,"2978":0,"2979":0,"2980":0,"2981":0,"2982":71,"2983":71,"2984":71,"2985":7,"2986":7,"2987":64,"2988":7,"2989":71,"2990":7,"2991":71,"2992":71,"2993":71,"2994":71,"2995":71,"2996":71,"2997":71,"2998":67,"2999":0,"3000":67,"3001":0,"3002":0,"3003":0,"3004":0,"3005":0,"3006":0,"3007":71,"3008":71,"3009":71,"3010":7,"3011":7,"3012":7,"3013":7,"3014":71,"3015":7,"3016":71,"3017":71,"3018":71,"3019":71,"3020":71,"3021":71,"3022":71,"3023":0,"3024":0,"3025":67,"3026":0,"3027":0,"3028":0,"3029":0,"3030":0,"3031":0,"3032":71,"3033":71,"3034":71,"3035":7,"3036":7,"3037":7,"3038":7,"3039":71,"3040":7,"3041":71,"3042":71,"3043":71,"3044":71,"3045":71,"3046":71,"3047":71,"3048":0,"3049":0,"3050":67,"3051":0,"3052":0,"3053":0,"3054":0,"3055":0,"3056":0,"3057":71,"3058":71,"3059":71,"3060":7,"3061":7,"3062":7,"3063":7,"3064":71,"3065":7,"3066":71,"3067":71,"3068":71,"3069":71,"3070":71,"3071":71,"3072":71,"3073":0,"3074":0,"3075":67,"3076":0,"3077":0,"3078":0,"3079":0,"3080":0,"3081":0,"3082":71,"3083":71,"3084":71,"3085":7,"3086":7,"3087":64,"3088":7,"3089":71,"3090":7,"3091":71,"3092":71,"3093":71,"3094":71,"3095":71,"3096":71,"3097":71,"3098":0,"3099":0,"3100":67,"3101":0,"3102":0,"3103":0,"3104":0,"3105":0,"3106":0,"3107":71,"3108":71,"3109":71,"3110":7,"3111":7,"3112":7,"3113":7,"3114":71,"3115":71,"3116":71,"3117":71,"3118":71,"3119":71,"3120":71,"3121":71,"3122":0,"3123":67,"3124":0,"3125":67,"3126":0,"3127":0,"3128":0,"3129":0,"3130":0,"3131":0,"3132":71,"3133":71,"3134":71,"3135":71,"3136":7,"3137":7,"3138":7,"3139":71,"3140":71,"3141":71,"3142":71,"3143":71,"3144":71,"3145":71,"3146":71,"3147":0,"3148":67,"3149":0,"3150":67,"3151":0,"3152":0,"3153":0,"3154":0,"3155":0,"3156":0,"3157":0,"3158":71,"3159":71,"3160":71,"3161":71,"3162":71,"3163":71,"3164":71,"3165":71,"3166":71,"3167":71,"3168":71,"3169":71,"3170":67,"3171":0,"3172":0,"3173":0,"3174":0,"3175":67,"3176":67,"3177":0,"3178":0,"3179":0,"3180":0,"3181":0,"3182":0,"3183":0,"3184":71,"3185":71,"3186":71,"3187":71,"3188":71,"3189":71,"3190":71,"3191":7,"3192":7,"3193":7,"3194":67,"3195":67,"3196":67,"3197":67,"3198":67,"3199":0,"3200":67,"3201":67,"3202":0,"3203":0,"3204":0,"3205":0,"3206":0,"3207":0,"3208":0,"3209":0,"3210":7,"3211":7,"3212":7,"3213":7,"3214":7,"3215":7,"3216":7,"3217":7,"3218":7,"3219":67,"3220":67,"3221":67,"3222":67,"3223":0,"3224":0,"3225":67,"3226":67,"3227":0,"3228":0,"3229":0,"3230":0,"3231":0,"3232":0,"3233":0,"3234":0,"3235":0,"3236":0,"3237":7,"3238":7,"3239":7,"3240":7,"3241":7,"3242":7,"3243":7,"3244":7,"3245":67,"3246":67,"3247":67,"3248":0,"3249":0,"3250":67,"3251":67,"3252":0,"3253":0,"3254":0,"3255":0,"3256":0,"3257":0,"3258":0,"3259":0,"3260":0,"3261":7,"3262":7,"3263":7,"3264":7,"3265":7,"3266":7,"3267":7,"3268":7,"3269":7,"3270":67,"3271":67,"3272":0,"3273":0,"3274":0,"3275":67,"3276":67,"3277":0,"3278":0,"3279":0,"3280":0,"3281":0,"3282":0,"3283":0,"3284":0,"3285":0,"3286":7,"3287":7,"3288":7,"3289":7,"3290":7,"3291":7,"3292":7,"3293":67,"3294":67,"3295":0,"3296":67,"3297":0,"3298":67,"3299":0,"3300":67,"3301":67,"3302":0,"3303":0,"3304":0,"3305":0,"3306":0,"3307":0,"3308":0,"3309":0,"3310":0,"3311":0,"3312":0,"3313":7,"3314":7,"3315":7,"3316":7,"3317":7,"3318":67,"3319":67,"3320":0,"3321":67,"3322":0,"3323":67,"3324":0,"3325":67,"3326":67,"3327":0,"3328":0,"3329":0,"3330":0,"3331":0,"3332":0,"3333":0,"3334":0,"3335":0,"3336":0,"3337":0,"3338":7,"3339":7,"3340":7,"3341":7,"3342":7,"3343":7,"3344":67,"3345":0,"3346":67,"3347":0,"3348":0,"3349":0,"3350":0,"3351":67,"3352":0,"3353":0,"3354":0,"3355":0,"3356":0,"3357":0,"3358":0,"3359":0,"3360":0,"3361":0,"3362":0,"3363":0,"3364":7,"3365":7,"3366":7,"3367":7,"3368":7,"3369":67,"3370":67,"3371":0,"3372":0,"3373":67,"3374":0,"3375":67,"3376":67,"3377":0,"3378":0,"3379":0,"3380":0,"3381":0,"3382":0,"3383":0,"3384":0,"3385":0,"3386":0,"3387":0,"3388":0,"3389":0,"3390":7,"3391":7,"3392":7,"3393":67,"3394":67,"3395":0,"3396":0,"3397":0,"3398":67,"3399":0,"3400":67,"3401":67,"3402":0,"3403":0,"3404":0,"3405":0,"3406":0,"3407":0,"3408":0,"3409":0,"3410":0,"3411":0,"3412":0,"3413":0,"3414":0,"3415":7,"3416":7,"3417":7,"3418":67,"3419":0,"3420":0,"3421":67,"3422":67,"3423":0,"3424":0,"3425":67,"3426":67,"3427":0,"3428":0,"3429":0,"3430":0,"3431":0,"3432":0,"3433":0,"3434":0,"3435":0,"3436":0,"3437":0,"3438":0,"3439":0,"3440":7,"3441":7,"3442":7,"3443":7,"3444":0,"3445":67,"3446":0,"3447":67,"3448":0,"3449":67,"3450":67,"3451":67,"3452":67,"3453":0,"3454":0,"3455":0,"3456":0,"3457":0,"3458":0,"3459":0,"3460":0,"3461":0,"3462":0,"3463":0,"3464":0,"3465":7,"3466":7,"3467":7,"3468":7,"3469":0,"3470":67,"3471":0,"3472":67,"3473":67,"3474":67,"3475":67,"3476":67,"3477":67,"3478":0,"3479":0,"3480":0,"3481":0,"3482":0,"3483":0,"3484":0,"3485":0,"3486":0,"3487":0,"3488":0,"3489":0,"3490":0,"3491":0,"3492":7,"3493":67,"3494":0,"3495":67,"3496":67,"3497":0,"3498":67,"3499":0,"3500":67,"3501":67,"3502":67,"3503":0,"3504":0,"3505":0,"3506":0,"3507":0,"3508":0,"3509":0,"3510":0,"3511":0,"3512":0,"3513":0,"3514":0,"3515":0,"3516":67,"3517":0,"3518":0,"3519":67,"3520":0,"3521":67,"3522":0,"3523":67,"3524":0,"3525":67,"3526":67,"3527":67,"3528":67,"3529":67,"3530":0,"3531":0,"3532":0,"3533":0,"3534":0,"3535":0,"3536":0,"3537":0,"3538":0,"3539":0,"3540":0,"3541":67,"3542":67,"3543":67,"3544":67,"3545":67,"3546":0,"3547":0,"3548":0,"3549":0,"3550":67,"3551":67,"3552":67,"3553":67,"3554":0,"3555":0,"3556":0,"3557":0,"3558":0,"3559":0,"3560":0,"3561":0,"3562":0,"3563":0,"3564":0,"3565":67,"3566":67,"3567":0,"3568":67,"3569":0,"3570":67,"3571":0,"3572":67,"3573":67,"3574":0,"3575":67,"3576":67,"3577":67,"3578":67,"3579":67,"3580":67,"3581":0,"3582":0,"3583":0,"3584":0,"3585":0,"3586":0,"3587":0,"3588":0,"3589":67,"3590":67,"3591":0,"3592":67,"3593":67,"3594":0,"3595":67,"3596":67,"3597":67,"3598":67,"3599":0,"3600":0,"3601":67,"3602":67,"3603":67,"3604":67,"3605":67,"3606":67,"3607":0,"3608":0,"3609":0,"3610":0,"3611":0,"3612":0,"3613":0,"3614":67,"3615":67,"3616":0,"3617":0,"3618":67,"3619":0,"3620":67,"3621":67,"3622":0,"3623":0,"3624":0,"3625":67,"3626":67,"3627":67,"3628":67,"3629":67,"3630":67,"3631":67,"3632":67,"3633":67,"3634":0,"3635":0,"3636":0,"3637":0,"3638":67,"3639":67,"3640":67,"3641":0,"3642":67,"3643":0,"3644":0,"3645":67,"3646":0,"3647":0,"3648":67,"3649":0,"3650":0,"3651":67,"3652":67,"3653":67,"3654":0,"3655":67,"3656":67,"3657":67,"3658":67,"3659":67,"3660":0,"3661":0,"3662":0,"3663":67,"3664":67,"3665":0,"3666":67,"3667":67,"3668":67,"3669":67,"3670":67,"3671":67,"3672":67,"3673":67,"3674":0,"3675":0,"3676":67,"3677":0,"3678":0,"3679":0,"3680":67,"3681":67,"3682":67,"3683":67,"3684":67,"3685":67,"3686":67,"3687":67,"3688":67,"3689":0,"3690":67,"3691":67,"3692":0,"3693":0,"3694":67,"3695":0,"3696":0,"3697":0,"3698":67,"3699":0,"3700":67,"3701":67,"3702":0,"3703":0,"3704":67,"3705":67,"3706":67,"3707":0,"3708":0,"3709":67,"3710":67,"3711":67,"3712":67,"3713":0,"3714":0,"3715":67,"3716":67,"3717":67,"3718":0,"3719":67,"3720":0,"3721":67,"3722":67,"3723":0,"3724":0,"3725":67,"3726":0,"3727":0,"3728":0,"3729":0,"3730":67,"3731":0,"3732":67,"3733":0,"3734":0,"3735":0,"3736":67,"3737":0,"3738":0,"3739":67,"3740":67,"3741":67,"3742":67,"3743":67,"3744":67,"3745":0,"3746":67,"3747":67,"3748":0,"3749":0,"3750":67,"3751":0,"3752":0,"3753":67,"3754":67,"3755":0,"3756":67,"3757":67,"3758":67,"3759":67,"3760":0,"3761":0,"3762":0,"3763":0,"3764":0,"3765":0,"3766":67,"3767":0,"3768":67,"3769":0,"3770":0,"3771":0,"3772":67,"3773":0,"3774":0,"3775":0,"3776":0,"3777":0,"3778":67,"3779":0,"3780":0,"3781":67,"3782":67,"3783":0,"3784":0,"3785":67,"3786":0,"3787":0,"3788":0,"3789":67,"3790":67,"3791":67,"3792":0,"3793":67,"3794":0,"3795":0,"3796":67,"3797":67,"3798":0,"3799":0,"3800":0,"3801":0,"3802":0,"3803":67,"3804":0,"3805":67,"3806":67,"3807":0,"3808":0,"3809":67,"3810":0,"3811":67,"3812":67,"3813":67,"3814":0,"3815":0,"3816":67,"3817":0,"3818":0,"3819":0,"3820":0,"3821":67,"3822":67,"3823":0,"3824":0,"3825":0,"3826":0,"3827":0,"3828":0,"3829":67,"3830":67,"3831":67,"3832":0,"3833":0,"3834":0,"3835":67,"3836":0,"3837":67,"3838":67,"3839":0,"3840":67,"3841":0,"3842":0,"3843":0,"3844":67,"3845":67,"3846":0,"3847":0,"3848":0,"3849":0,"3850":0,"3851":0,"3852":67,"3853":67,"3854":67,"3855":0,"3856":67,"3857":0,"3858":0,"3859":0,"3860":67,"3861":67,"3862":67,"3863":0,"3864":67,"3865":67,"3866":67,"3867":0,"3868":67,"3869":0,"3870":0,"3871":0,"3872":0,"3873":0,"3874":0,"3875":0,"3876":0,"3877":67,"3878":0,"3879":0,"3880":0,"3881":0,"3882":0,"3883":67,"3884":67,"3885":67,"3886":67,"3887":0,"3888":67,"3889":67,"3890":67,"3891":0,"3892":0,"3893":0,"3894":0,"3895":0,"3896":0,"3897":67,"3898":67,"3899":0,"3900":0,"3901":0,"3902":67,"3903":67,"3904":67,"3905":0,"3906":0,"3907":67,"3908":67,"3909":0,"3910":67,"3911":0,"3912":67,"3913":67,"3914":67,"3915":67,"3916":0,"3917":0,"3918":0,"3919":0,"3920":0,"3921":0,"3922":0,"3923":0,"3924":0,"3925":0,"3926":0,"3927":67,"3928":67,"3929":67,"3930":67,"3931":67,"3932":67,"3933":67,"3934":67,"3935":0,"3936":0,"3937":0,"3938":67,"3939":0,"3940":0,"3941":0,"3942":0,"3943":0,"3944":0,"3945":0,"3946":0,"3947":0,"3948":0,"3949":0,"3950":0,"3951":67,"3952":0,"3953":0,"3954":0,"3955":0,"3956":0,"3957":0,"3958":0,"3959":0,"3960":0,"3961":0,"3962":67,"3963":0,"3964":0,"3965":0,"3966":0,"3967":0,"3968":0,"3969":0,"3970":0,"3971":0,"3972":0,"3973":0,"3974":0,"3975":0,"3976":0,"3977":0,"3978":0,"3979":67,"3980":0,"3981":67,"3982":67,"3983":67,"3984":67,"3985":67,"3986":67,"3987":0,"3988":0,"3989":0,"3990":0,"3991":0,"3992":0,"3993":0,"3994":0,"3995":0,"3996":0,"3997":0,"3998":0,"3999":0}

function onCmvMsg(e) {
    switch (e.data.event) {
        case 'play':
            frame.width = e.data.width;
            frame.height = e.data.height;
            canvas.width = tileset.width * frame.width;
            canvas.height = tileset.height * frame.height;
            e.data.width = canvas.width;
            e.data.height = canvas.height;
            postMessage(
                e.data
            )
            break;
        case 'frame':
            cur_frame = e.data.data
            renderFrame(cur_frame);
            break;
    }
}

self.onmessage = function(e) {
    switch (e.data.event) {
        case 'connect':
            cmv = e.ports[0];
            cmv.onmessage = onCmvMsg;
            break;
        case 'tileset':
            console.log("Tileset requested: ", e.data)
            getTileset(e.data.src);
            break;
        case 'colorscheme':
            console.log("Color scheme requested: ", e.data)
            tileset.colors = parseColorScheme(e.data.src);
            break;
        case 'canvas':
            console.log("Render canvas setup")
            canvas = e.data.canvas
            ctx = canvas.getContext('2d')
            break;
    }
}

async function parseColorScheme(src) {

    const rgb_index = {"R": 0, "G": 1, "B": 2}

    const color_index = {
        "BLACK":    [0,0],
        "BLUE":     [0,1],
        "GREEN":    [0,2],
        "CYAN":     [0,3],
        "RED":      [0,4],
        "MAGENTA":  [0,5],
        "BROWN":    [0,6],
        "LGRAY":    [0,7],
        "DGRAY":    [1,0],
        "LBLUE":    [1,1],
        "LGREEN":   [1,2],
        "LCYAN":    [1,3],
        "LRED":     [1,4],
        "LMAGENTA": [1,5],
        "YELLOW":   [1,6],
        "WHITE":    [1,7]
    }

    const scheme = await fetch(src || 'tilesets/colors.txt').then(r => r.text());

    let cr = [[],[]];
    for (let z = 0; z<8; z+=1) {
        cr[0].push([0,0,0])
        cr[1].push([0,0,0])
    }

    let lines = scheme.split(/\r\n|\n/);

    lines.forEach( line => {
        const c = line.match(/([A-Z]+)_([A-Z]):(\d{1,3})/);
        if (c) {
            cr[color_index[c[1]][0]][color_index[c[1]][1]][rgb_index[c[2]]] = Number(c[3]);
        }
    });
    tileset.colors = cr;

    // when paused, re-render last frame
    renderFrame(cur_frame);
}

async function getTileset(src) {

    const imgblob = await fetch(src || 'tilesets/curses_800x600.png').then(r => r.blob());
    const img = await createImageBitmap(imgblob);

    tileset.width = img.width / 16;
    tileset.height = img.height / 16;

    if (frame.width && frame.height) {
            canvas.width = tileset.width * frame.width;
            canvas.height = tileset.height * frame.height;
            postMessage({
                event: 'resize',
                width: canvas.width,
                height: canvas.height
            })
    }

    const c = new OffscreenCanvas(img.width, img.height);
    var ctx = c.getContext('2d');
    ctx.drawImage(img, 0, 0, img.width , img.height);
    tileset.tiles = [];

    for (var y = 0; y < 16; y++) {
        for (var x = 0; x < 16; x++) {
            tileset.tiles.push(ctx.getImageData(x * tileset.width, y * tileset.height, tileset.width, tileset.height));
        }
    }
    // when paused, re-render last frame
    renderFrame(cur_frame);
}

function renderFrame(frame_data) {
//    let start = performance.now();
    let imageData = ctx.createImageData(canvas.width, canvas.height);
    for (let tx = 0; tx < frame.width; tx++) {
        for (let ty = 0; ty < frame.height; ty++) {
            let off1 = tx * frame.height + ty;
            let off2 = off1 + frame.width * frame.height;

            let t = tileset.tiles[frame_data[off1]];
            let fg = tileset.colors[frame_data[off2] >> 6][frame_data[off2] & 7];
            let bg = tileset.colors[0][(frame_data[off2] >> 3) & 7];

            for (let x = 0; x < tileset.width; x++) {
                for (let y = 0; y < tileset.height; y++) {
                    let off = (x + y * tileset.width) * 4;
                    let r = t.data[off + 0], g = t.data[off + 1], b = t.data[off + 2], a = t.data[off + 3];
                    if (r == 255 && g == 0 && b == 255 && a == 255) {
                        r = g = b = a = 0;
                    }
                    off = ((x + tx * tileset.width) + (y + ty * tileset.height) * imageData.width) * 4;
                    imageData.data[off + 0] = (r * a * fg[0] / 255 + (255 - a) * bg[0]) / 255;
                    imageData.data[off + 1] = (g * a * fg[1] / 255 + (255 - a) * bg[1]) / 255;
                    imageData.data[off + 2] = (b * a * fg[2] / 255 + (255 - a) * bg[2]) / 255;
                    imageData.data[off + 3] = 255;
                }
            }
        }
    }
    ctx.putImageData(imageData, 0, 0);
//    console.log("Frame time: ", performance.now() - start, "ms")
}
